<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:SBComp="http://xmlns.jcp.org/jsf/composite/SBComp"
    xmlns:crm="http://xmlns.jcp.org/jsf/composite/crm"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    template="#{layoutsPaginas.conteudoEmBranco.xhtmlVinculado}"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:define name="conteudo">
        <div class="CardTopic " style="margin-left: 10px; height: 100px;padding: 10px; position: relative;">
            #{pgSolicitacaoAtendimento.categoriaEquipe.nome}
            <i class="fa fa-folder-open-o Fs100 Fleft MarRight10"></i>
            <br/>
            <div class="quebraBlocoComEspacoVertical10 somenteMobile"></div>
            <span class="CardSubTopic FontAdamantiumBold Fs16">
                Atendendo a solicitação de #{pgSolicitacaoAtendimento.entidadeSelecionada.usuarioSolicitante.nome}<br/>
                <span style="font-style: italic;" class="Fs24" >"#{pgSolicitacaoAtendimento.entidadeSelecionada.obeservacao}"</span>
                <h:panelGroup layout="block" styleClass="Container3" id="usrTEam" >



                    <h:panelGroup styleClass="" style="position: relative;    margin-top: 20px;margin-left: 40px;"  layout="block"  >
                        <crm:avatar usuario="#{pgSolicitacaoAtendimento.entidadeSelecionada.usuarioSolicitante}" somenteLeitura="true" altura="90" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="fa fa-hand-paper-o Fs40 containerBtnSeletor"   style="margin-left: 130px;"  >
                    </h:panelGroup>



                </h:panelGroup>
            </span>
            <h:panelGroup styleClass="Fright" style="position: relative  " layout="block">

            </h:panelGroup>
        </div>

        <h:form>
            <p:remoteCommand name="atualizarVisaoArquivosPessoa" actionListener="#{pgSolicitacaoAtendimento.atualizarEntidadeSelecionada()}"
                             update="arquivosDaCategoria"
                             >

            </p:remoteCommand>

        </h:form>


        <p:fieldset  style="border: 0px; width: 100%;">
            <h:form  enctype="multipart/form-data">
                <p:fileUpload
                    mode="advanced"  multiple="true"

                    auto="true"
                    listener="#{servicosCRM.enviarArquivosEquipePessoa}"
                    update="@parent"
                    styleClass="inputDropArquivo"
                    sizeLimit="15485760" allowTypes="/(\.|\/)(gif|jpe?g|png|pdf|doc|docx|xml|xmlx)$/"
                    invalidSizeMessage="O tamanho máximo permitido é 100 KB"
                    invalidFileMessage="Este tipo de arquivo não é permitido, apenas: png|pdf|doc|docx|xml|xmlx são permitidos"
                    label="Procurar no meu dispositivo local"
                    oncomplete="atualizarVisaoArquivosPessoa();"
                    uploadLabel="Atualizar Arquivos da Pessoa"
                    cancelLabel="Cancelar"

                    >
                    <f:attribute name="pessoa"  value="#{pgSolicitacaoAtendimento.pessoa}" />
                    <f:attribute name="categoriaEquipe"  value="#{pgSolicitacaoAtendimento.categoriaEquipe}" />
                    <f:attribute name="solicitacaoArquivoEquipe"  value="#{pgSolicitacaoAtendimento.entidadeSelecionada}" />
                </p:fileUpload>
            </h:form>

            <h:panelGroup styleClass="Container12" style="margin-top: -250px; padding-left: 50%;" layout="block" >

                <p:graphicImage  library="img" alt="Arraste arquivos aqui para vincular o arquivo à pessoa." name="upload-illustration.png" />
                (ou arraste aqui)
            </h:panelGroup>
        </p:fieldset>
        <p:fieldset styleClass="Container12" id="arquivosDaCategoria" >



            <c:forEach  items="#{pgSolicitacaoAtendimento.categoriaEquipe.arquivos}" var="arquivo" >
                <h:form>
                    <p:confirmDialog global="true">
                        <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </p:confirmDialog>
                    <p:fieldset  id="arquivos" styleClass="Container3" >
                        <f:facet name="legend">
                            <p:growl id="message" showDetail="true"/>
                            <p:commandButton
                                partialSubmit="true"
                                process="@this"
                                onclick="javaScript:window.open('#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkBaixarArquivo}', '_blank');"
                                icon="#{iconeIconeFontAwesome.REG_BAIXAR.tagHtml}"
                                />
                            <p:commandButton

                                partialSubmit="true"
                                process="@this"
                                onclick="javaScript:window.open('#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkAbrirArquivo}', '_blank');"
                                icon="#{iconeIconeFontAwesome.REG_VISUALIZAR.tagHtml}"
                                />
                            <p:commandButton
                                partialSubmit="true"
                                rendered="false"
                                actionListener="#{servicosCRM.excluirArquivoAnexoPessoa(arquivo)}"
                                icon="#{iconeIconeFontAwesome.REG_REMOVER.tagHtml}"
                                oncomplete="atualizarVisaoArquivosPessoa();"

                                >
                                <p:confirm header="Confirmation" message="Deseja compartilhar com o cliente  o arquivo #{arquivo.nome} ?" icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>

                            <p:commandButton
                                partialSubmit="true"

                                actionListener="#{servicosCRM.excluirArquivoAnexoPessoa(arquivo)}"
                                icon="#{iconeIconeFontAwesome.REG_REMOVER.tagHtml}"
                                oncomplete="atualizarVisaoArquivosPessoa();"

                                >
                                <p:confirm header="Confirmation" message="Deseja excluir #{arquivo.nome} de forma irreversível?" icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>
                            #{arquivo.nomeCurto}
                        </f:facet>

                        <p:panelGrid columns="3" styleClass=""  style="width: 100%;" >
                            <h:panelGroup layout="block" >Tipo</h:panelGroup>
                            <h:panelGroup layout="block" >Criado Por</h:panelGroup>
                            <h:panelGroup layout="block" >Criado às</h:panelGroup>
                            <h:panelGroup layout="block" >


                                <i class="Fs50 #{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.iconeTipoArquivo}"/>

                            </h:panelGroup>
                            <h:panelGroup layout="block" >

                                <crm:avatar  id="criado_por" usuario="#{arquivo.usuarioCriou}" somenteLeitura="true" />

                            </h:panelGroup>

                            <h:panelGroup layout="block" >


                                <p:outputLabel id="dataHoraCriou" value="#{pgUtil.gerarDataHoraTexto(arquivo.dataHoraCriacao)}" />

                            </h:panelGroup>


                        </p:panelGrid>


                        <h:panelGroup layout="block" style="width: 100%;" rendered="arquivo.dataHoraAlteracao!=null">
                            *    Alterado dia #{pgUtil.gerarHoraTexto(arquivo.dataHoraAlteracao)} por:      <crm:avatar usuario="#{arquivo.usuarioAlteracao}" somenteLeitura="true" />
                        </h:panelGroup>

                    </p:fieldset>
                </h:form>

            </c:forEach>

        </p:fieldset>

        <crm:menuProspecto  pessoaJuridica="#{pgSolicitacaoAtendimento.pessoa}"
                            rendered="#{pgSolicitacaoAtendimento.pessoa!=null}"
                            />
    </ui:define>
</ui:composition>