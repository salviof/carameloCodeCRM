<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:SBCRM="http://xmlns.jcp.org/jsf/composite/crm"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="areaAtualizacao" required="true"/>
        <cc:attribute name="agendaDiponibilidade"
                      type="org.coletivoJava.fw.projetos.agendamentoPublico.model.escopoPesquisa.AgendaDisponibilidade"
                      required="true"/>
        <cc:attribute name="vagasDisponiveis" default="false"/>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>


        <h:panelGroup styleClass="calendario-card-container">
            <script>
                //<![CDATA[

                function dateTemplateFunc(date) {
                    return '<span style="background-color:' + ((date.selectable) ? '#60a36c' : 'inherit') +
                            ';border-radius:50%;width: 2.5rem;height: 2.5rem;line-height: 2.5rem;display: flex;align-items: center;justify-content: center;">' + date.day + '</span>';
                }

                function toggleCalendarLoading(show) {
                    var card = document.querySelector('.calendario-card');
                    if (show) {
                        card.classList.add('loading');
                    } else {
                        card.classList.remove('loading');
                    }
                }

                //]]>
            </script>

            <h:panelGroup layout="block" styleClass="calendario-card"
                          rendered="#{cc.attrs.agendaDiponibilidade.diaSelecionado!=null}">

                <h:form>
                    <!-- TÃ­tulo do card -->
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #343a40; margin: 0 0 8px 0; font-weight: 600;">Selecione a Data</h3>
                        <p style="color: #6c757d; margin: 0; font-size: 0.9em;">Escolha o dia para sua reserva

                        </p>
                    </div>

                    <!-- Display da data selecionada -->
                    <a href="javascript:PF('seletorDia').show();" style="text-decoration: none; display: block;">
                        <div class="calendar-date-display">
                            <div class="calendar-date-month">
                                #{pgUtilDataHoraFormato.getMesExtenso(cc.attrs.agendaDiponibilidade.diaSelecionadoComoData)}
                            </div>
                            <div class="calendar-date-day">
                                #{pgUtilDataHoraFormato.getDiaDoMes(cc.attrs.agendaDiponibilidade.diaSelecionadoComoData)}

                            </div>
                            <div class="calendar-date-weekday">
                                #{pgUtilDataHoraFormato.getDiaDaSemana(cc.attrs.agendaDiponibilidade.diaSelecionadoComoData)}
                            </div>
                        </div>
                    </a>

                    <!-- Mensagem informativa -->
                    <div class="calendar-info-message">
                        <i class="pi pi-info-circle" style="margin-right: 8px"></i>
                        Clique na data acima para escolher outro dia
                    </div>
                    <h:panelGroup styleClass="calendar-info-message-custom"
                                  rendered="#{cc.attrs.vagasDisponiveis eq true}"> Existem #{pgReservasPublicas.agendaDisponivel.escopo.getCampoInstanciadoByNomeOuAnotacao('qtdReservasDisponiveis').valor} vagas
                        para #{pgReservasPublicas.agendaDisponivel.escopo.tipoAgendamento.nome}
                    </h:panelGroup>


                    <!-- DatePicker escondido -->
                    <p:datePicker
                        value="#{cc.attrs.agendaDiponibilidade.diaSelecionado}"
                        disabledDates="#{cc.attrs.agendaDiponibilidade.diasDesativados}"
                        focusOnSelect="true"
                        widgetVar="seletorDia"
                        appendTo="@(body)"
                        dateTemplate="dateTemplateFunc"
                        locale="pt_BR"
                        inputStyle="display: none;"
                        style="visibility: visible;"

                        >

                        <p:ajax
                            onstart="toggleCalendarLoading(true);"
                            oncomplete="toggleCalendarLoading(false); PF('seletorDia').hide();"
                            global="true"
                            event="dateSelect"
                            update=":painelHorariosDisponives @form">
                        </p:ajax>
                    </p:datePicker>
                </h:form>
            </h:panelGroup>
        </h:panelGroup>


    </cc:implementation>
</ui:composition>