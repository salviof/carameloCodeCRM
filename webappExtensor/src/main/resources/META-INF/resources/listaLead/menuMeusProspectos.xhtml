<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:SBInput="http://xmlns.jcp.org/jsf/composite/SBComp/composite/input"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core">
    <!-- INTERFACE -->
    <cc:interface>

        <cc:attribute name="pesquisa"
                      type="com.super_bits.Casa_Nova.Intranet_Marketing_Digital.model.dados.crm.prospecto.pesquisaLead.PesquisaLead"
                      required="true"/>
    </cc:interface>
    <!-- IMPLEMENTATION -->
    <cc:implementation>


        <p:megaMenu orientation="horizontal" autoDisplay="false"  rendered="true" >
            <p:submenu label="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('tipoPesquisa').valor.nome}"
                       icon="fa fa-address-card-o" expanded="false"   >
                <p:column>
                    <p:submenu label="Tipo de Pesquisa" >
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('tiposDisponiveis').valor}"
                                   var="tipoPesquisa" >

                            <p:menuitem value="#{tipoPesquisa.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('tipoPesquisa').valorValidando}"

                                                             value="#{tipoPesquisa}" />

                            </p:menuitem>




                        </c:forEach>
                    </p:submenu>
                </p:column>

            </p:submenu>
            <p:submenu label="#{cc.attrs.pesquisa.getCampoByNomeOuAnotacao('textoIntervaloDatas').valor}" >

                <p:column >
                    <p:submenu label="Intervalo" >
                        <p:menuitem oncomplete="PF('defineIntervalo').show()"
                                    icon="fa fa-calender"
                                    process="@this"
                                    value="Definir novo intervalor"
                                    />

                        <p:menuitem icon="fa fa-ban"
                                    process="@this"

                                    value="Sempre"
                                    update="@form"
                                    actionListener="#{cc.attrs.pesquisa.limparDatas()}"/>
                    </p:submenu>
                </p:column>

            </p:submenu>
            <p:submenu label="#{cc.attrs.pesquisa.usuario.nome}" disabled="true"  >
                <p:column>
                    <p:submenu label="Usuários disponiveis" disabled="true" >
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('usuariosDisponiveis').valor}"
                                   var="usuario" >

                            <p:menuitem value="#{usuario.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.usuario}"

                                                             value="#{usuario}" />
                            </p:menuitem>




                        </c:forEach>
                    </p:submenu>
                </p:column>

            </p:submenu>

            <p:submenu label="#{cc.attrs.pesquisa.origem==null ? 'Todas origens': cc.attrs.pesquisa.origem.nome} " >
                <p:column>
                    <p:submenu label="Minhas Origens"  >
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('origensPrivadas').valor}"
                                   var="origemPrivada" >
                            <p:menuitem value="#{origemPrivada.nome}"

                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('origem').valorValidando}"

                                                             value="#{origemPrivada}" >

                                </f:setPropertyActionListener>

                            </p:menuitem>
                        </c:forEach>
                    </p:submenu>

                    <p:submenu label="Origens Públicas" >
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('origensPublicas').valor}"
                                   var="origemPub" >
                            <p:menuitem value="#{origemPub.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.origem}"
                                                             value="#{origemPub}" />
                            </p:menuitem>
                        </c:forEach>
                    </p:submenu>

                    <p:submenu label="Origens Compartilhadas" >
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('origensPrivadasCompatilhadas').valor}"
                                   var="origemComp" >
                            <p:menuitem value="#{origemPub.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.origem}"
                                                             value="#{origemComp}" />
                            </p:menuitem>
                        </c:forEach>
                    </p:submenu>
                </p:column>
            </p:submenu>

            <p:submenu label="#{cc.attrs.pesquisa.metaRelacionamento==null ? 'Todas as Metas': cc.attrs.pesquisa.metaRelacionamento.nome} " >
                <p:column>
                    <p:submenu label="Metas disponíveis" >
                        <p:menuitem value="Todas as metas"
                                    update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                    actionListener="#{cc.attrs.pesquisa.limparMeta()}"
                                    >

                        </p:menuitem>
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('metasDisponiveis').valor}"
                                   var="meta" >
                            <p:menuitem value="#{meta.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.metaRelacionamento}"
                                                             value="#{meta}" />
                            </p:menuitem>
                        </c:forEach>

                    </p:submenu>
                </p:column>
            </p:submenu>

            <p:submenu label="#{cc.attrs.pesquisa.tipoRelacionamento==null ? 'Todas etapas': cc.attrs.pesquisa.tipoRelacionamento.nome} "  rendered="#{cc.attrs.pesquisa.metaRelacionamento!=null}"  >
                <p:column>
                    <p:submenu label="Relacionamentos disponiveis">
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('tiposDeRelacionamentoDisponivel').valor}"
                                   var="tipoRelacionamento" >
                            <p:menuitem value="#{tipoRelacionamento.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.tipoRelacionamento}"
                                                             value="#{tipoRelacionamento}" />
                            </p:menuitem>
                        </c:forEach>
                    </p:submenu>
                </p:column>
            </p:submenu>

            <p:submenu label="Tags" >
                <p:column>
                    <p:submenu label="Tags disponíveis">
                        <c:forEach items="#{cc.attrs.pesquisa.getCampoInstanciadoByNomeOuAnotacao('tagsDisponiveis').valor}"
                                   var="tagAtendimento" >
                            <p:menuitem value="#{tagAtendimento.nome}"
                                        update="@form #{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"
                                        >
                                <f:setPropertyActionListener target="#{cc.attrs.pesquisa.tagAtendimento}"
                                                             value="#{tagAtendimento}" />
                            </p:menuitem>
                        </c:forEach>
                    </p:submenu>
                </p:column>

            </p:submenu>

            <p:menuitem>
                <p:fragment>


                    <p:inputText
                        styleClass="Fs16"
                        id="pesquisaLead"

                        value="#{cc.attrs.pesquisa.termoPesquisa}"
                        style="width:400px; opacity: 0.8;"
                        placeholder="Pesquise aqui em: #{cc.attrs.pesquisa.tipoPesquisa.nome}:">

                        <p:ajax

                            event="valueChange"
                            onstart="bloquearArea('#{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}')"
                            oncomplete="desbloquearArea('#{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}')"
                            process="@this"
                            update="#{pgUtil.gerarCaminhoCompletoID('gridListagemMeusProspets')}"/>
                    </p:inputText>

                    <p:button icon="fa fa-search" disabled="true" id="botaoFakePesquisa"  styleClass="botaoVerde" />
                    <script>
                        idInputTermopesquisa = PrimeFaces.escapeClientId('#{pgUtil.gerarCaminhoCompletoID('pesquisaLead')}');
                        idBotaoFakepesquisa = PrimeFaces.escapeClientId('#{pgUtil.gerarCaminhoCompletoID('botaoFakePesquisa')}');
                        console.log(idInputTermopesquisa);
                        $(idInputTermopesquisa).keypress(function (event) {

                            if (event.which === 13) {
                                event.preventDefault();
                                $(idInputTermopesquisa).blur();

                            }
                        });
                    </script>
                </p:fragment>

                <p:focus for="pesquisaLead" />
            </p:menuitem>






        </p:megaMenu>

    </cc:implementation>
</ui:composition>










