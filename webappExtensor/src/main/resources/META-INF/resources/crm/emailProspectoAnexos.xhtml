<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:SBCRMMAIL="http://xmlns.jcp.org/jsf/composite/crmEmail"
    xmlns:sb="http://superbitsframework/ui"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="empresa"
                      type="com.super_bits.Casa_Nova.Intranet_Marketing_Digital.model.dados.crm.prospecto.Pessoa" required="true"/>
        <cc:attribute name="email"
                      type="com.super_bits.Casa_Nova.Intranet_Marketing_Digital.model.dados.crm.mail.envioEmail.envioEmail.EnvioEmail" required="true"/>
        <cc:attribute name="metodoAposAtualizarEmail" type="javax.el.MethodExpression"  required="false" />
        <cc:attribute name="mostarContato" default="true" />
    </cc:interface>
    <!-- IMPLEMENTATION -->
    <cc:implementation>

        <h:panelGroup styleClass="Container12" style="margin-top: 20px;" layout="block" id="campo-anexos">
            <p:fieldset legend="Selecione os arquivos anexados:" rendered="#{cc.attrs.email!=null}" styleClass="Container5" style="height: 345px;width: 100%;"  >
                <h:panelGroup styleClass="Container12" layout="block" style="top:-30px;position: relative;" >

                    <h:form>
                        <SBCRMMAIL:inputEnvioEmailCampoAnexo
                            email="#{cc.attrs.email}"
                            colunasBotaoInsersao="12"
                            colunasLocalizacao="12"
                            />

                        <p:fieldset
                            id="arquivoRapidoAdd"
                            rendered="#{cc.attrs.email!=null}" styleClass="Container5" style="height: auto;width: 100%"  >
                            <h:panelGroup styleClass="Container12" layout="block" style="top:-30px;position: relative;" >

                                <c:forEach var="arquivo" items="#{cc.attrs.empresa.getCampoInstanciadoByNomeOuAnotacao('ultimosArquivos').valor}"    >
                                    <h:panelGroup layout="block" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" styleClass="chipDiv Container12">
                                        <h:panelGroup layout="block" styleClass="Container12" >
                                            <p:fragment >
                                                <p:commandLink rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" actionListener="#{cc.attrs.email.adicionarArquivoAnexado(arquivo)}"
                                                               styleClass=""
                                                               update="@form #{pgUtil.gerarCaminhoCompletoID('compEmailAnexos')}">
                                                    <h:panelGroup layout="block" styleClass="Container1" >
                                                        <h:panelGroup styleClass="fa fa-plus Fs16" style="color: #009900; margin: 0px;" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" />
                                                    </h:panelGroup>
                                                    <h:panelGroup layout="block" styleClass="Container10 Fs12"  style=" margin: 0px;">
                                                        #{arquivo.arquivo}
                                                    </h:panelGroup>

                                                </p:commandLink>
                                                <h:panelGroup layout="block" styleClass="Container12 OrganizadorContainer"  style=" margin: 0px;margin-top: -20px;">
                                                    <p:link href="#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkAbrirArquivo}" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}"   >
                                                        <i class="fa fa-eye" /> ver
                                                    </p:link>
                                                    <p:link href="#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkBaixarArquivo}" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}"   >
                                                        <i class="fa fa-download" /> baixar
                                                    </p:link>
                                                </h:panelGroup>
                                            </p:fragment>
                                        </h:panelGroup>

                                    </h:panelGroup>
                                </c:forEach>

                            </h:panelGroup>

                        </p:fieldset>
                    </h:form>
                </h:panelGroup>
            </p:fieldset>
        </h:panelGroup>
        <h:panelGroup styleClass="Container12" layout="block">


            <h:form>
                <p:fragment >
                    <p:remoteCommand async="true" process="@this"
                                     actionListener="#{paginaAtual.comoPaginaComModalEmail.onModalAnexoEmailClose}"
                                     update="#{pgUtil.gerarCaminhoCompletoID('campo-anexos')}"
                                     name="atualizaranexos" />
                </p:fragment>


                <p:fragment >
                    <p:remoteCommand async="true" process="@parent"  update="@parent" name="atualizarValoresUploadDireto" >
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.entidade}" value="#{cc.attrs.empresa}" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.caminhoCampo}" value="arquivos" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.caminhoCampo}" value="arquivos" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.email}" value="#{cc.attrs.email}" />
                    </p:remoteCommand>
                </p:fragment>
                <p:fieldset rendered="#{cc.attrs.email==null}">
                    O email n√£o foi configurado
                </p:fieldset>
            </h:form>




        </h:panelGroup>


    </cc:implementation>
</ui:composition>