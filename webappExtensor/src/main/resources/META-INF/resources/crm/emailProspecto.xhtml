<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:sb="http://superbitsframework/ui"
    xmlns:SBInput="http://xmlns.jcp.org/jsf/composite/SBComp/composite/input"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html">
    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="empresa"
                      type="br.org.carameloCode.erp.modulo.crm.entidadesJPA.prospecto.PessoaJuridica" required="true"/>
        <cc:attribute name="email"
                      type="br.org.carameloCode.erp.modulo.crm.entidadesJPA.mail.envioEmail.envioEmail.EnvioEmail" required="true"/>
        <cc:attribute name="metodoAposAtualizarEmail" type="javax.el.MethodExpression"  required="false" />
        <cc:attribute name="mostarContato" default="true" />
    </cc:interface>
    <!-- IMPLEMENTATION -->
    <cc:implementation>


        <p:fieldset rendered="#{cc.attrs.email==null}">
            O email não foi configurado
        </p:fieldset>


        <p:fieldset rendered="#{cc.attrs.email!=null and cc.attrs.mostarContato}"  >
            <sb:parametroMetodo nome="metodoAposContato" valor="#{cc.attrs.metodoAposAtualizarEmail}" />
            <f:facet name="legend" >
                Selecione os contatos que receberão os e-mails
                <h:panelGroup styleClass="Fright" rendered="#{pgUtil.isAtributoPreenchidoComExpressao(cc, 'metodoAposAtualizarEmail')}">
                    <p:commandButton

                        styleClass="btnIconeENome botao"
                        icon="#{servicosCRM.acaoContatos.icone}"
                        value="Editar Contato do Prospecto"
                        actionListener="#{servicosCRM.exibirModalProspecto(cc.attrs.email.prospecto,servicosCRM.acaoContatos)}"  >

                        <p:ajax event="dialogReturn" listener="#{metodoAposContato}"  update="#{pgUtil.gerarCaminhoCompletoID('contatosProsp')}" />
                    </p:commandButton>
                </h:panelGroup>
            </f:facet>
            <h:panelGrid id="contatosProsp">
                <p:selectManyCheckbox  value="#{cc.attrs.email.contatos}" layout="grid" columns="#{sessaoAtualSBWP.telaUsuario.numeroMaximoColunasAteSeis}">
                    <f:attribute name="collectionType" value="java.util.ArrayList" />
                    <f:selectItems value="#{cc.attrs.empresa.contatosComEmail}" var="arquivo" itemLabel="#{arquivo.email}" itemValue="#{arquivo}" />
                </p:selectManyCheckbox>
            </h:panelGrid>
        </p:fieldset>


        <p:fieldset legend="Conteúdo" id="conteudoEmail" styleClass="conteudoEmail" rendered="#{cc.attrs.email!=null}" >

            <SBInput:input registro="#{cc.attrs.email.getCampoInstanciadoByNomeOuAnotacao('assunto')}"
                           layout="#{layoutsComponenteSB.layoutCampo.superior}"
                           />

            [Input email aqui]
            <p:poll async="true" process="@form"
                    listener="#{servicosCRM.salvarHistoricoEdicaoEmail(cc.attrs.email)}"
                    interval="15" autoStart="true" />
        </p:fieldset>
        <p:fieldset legend="Selecione os arquivos anexados:" rendered="#{cc.attrs.email!=null}" >
            <p:selectManyCheckbox  value="#{cc.attrs.email.arquivosAnexados}" layout="grid"  columns="3">
                <f:attribute name="collectionType" value="java.util.ArrayList" />
                <f:selectItems value="#{cc.attrs.empresa.arquivos}" var="arquivo" itemLabel="#{arquivo.arquivo}" itemValue="#{arquivo}" />

            </p:selectManyCheckbox>
        </p:fieldset>

    </cc:implementation>
</ui:composition>