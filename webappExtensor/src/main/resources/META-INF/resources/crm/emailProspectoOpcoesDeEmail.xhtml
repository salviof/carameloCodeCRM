<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:SBCRMMAIL="http://xmlns.jcp.org/jsf/composite/crmEmail"
    xmlns:sb="http://superbitsframework/ui"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="empresa"
                      type="br.org.carameloCode.erp.modulo.crm.entidadesJPA.prospecto.Pessoa" required="true"/>
        <cc:attribute name="email"
                      type="br.org.carameloCode.erp.modulo.crm.entidadesJPA.mail.envioEmail.envioEmail.EnvioEmail" required="true"/>
        <cc:attribute name="metodoAposAtualizarEmail" type="javax.el.MethodExpression"  required="false" />
        <cc:attribute name="mostarContato" default="true" />
    </cc:interface>
    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <sb:parametroMetodo nome="metodoAposContato" valor="#{cc.attrs.metodoAposAtualizarEmail}" />
        <h:panelGroup styleClass="Container12" layout="block" id="resumoDestino" >
            <h:panelGroup styleClass="Container12" layout="block"  >



                <h:panelGroup id="contatosProsp" layout="block"   styleClass="Container12" >
                    <h:form>
                        <SBCRMMAIL:inputEnvioEmailCampoPara
                            email="#{cc.attrs.email}"

                            />
                    </h:form>
                    <h:form>

                        <p:selectBooleanButton
                            id="value2" value="#{cc.attrs.email.enviarCopiaColaboradores}"
                            onLabel="Os colaboradores serão adicionados em cópia"
                            offLabel="Não adicionar os colaboradores em cópia"
                            style="margin-top: 9px" onIcon="fa fa-check"
                            offIcon="fa fa-times"
                            styleClass="#{cc.attrs.email.enviarCopiaColaboradores?'botaoVerde':'botaoLaranjas'}"
                            >
                            <p:ajax event="change" process="@this" update="@this"  />

                        </p:selectBooleanButton>
                    </h:form>
                </h:panelGroup>
                <p:outputLabel value="Nenhum contato foi encontrado, neste prospecto" rendered="#{cc.attrs.empresa.contatosComEmail.size()==0}"/>
                <p:fieldset
                    id="contatosRapidoAdd"
                    rendered="#{cc.attrs.email!=null}" styleClass="Container5" style="height: auto;width: 100%"  >
                    <f:facet name="legend" >Seleção de contato com um click</f:facet>
                    <h:panelGroup styleClass="Container12" layout="block" style="top:-30px;position: relative;" >
                        <h:form>
                            <c:forEach var="contatoLead" items="#{cc.attrs.empresa.contatosComEmail}" >
                                <p:commandLink rendered="#{!cc.attrs.email.contatos.contains(contatoLead)}" actionListener="#{cc.attrs.email.adicionarContato(contatoLead)}"
                                               styleClass=""
                                               update="@form #{pgUtil.gerarCaminhoCompletoID('contatosProsp')}">
                                    <h:panelGroup layout="block" rendered="#{!cc.attrs.email.contatos.contains(contatoLead)}" styleClass="chipDiv">

                                        <h:panelGroup styleClass="fa fa-plus Fs16" style="color: #009900;" rendered="#{!cc.attrs.email.contatos.contains(contatoLead)}" />
                                        #{contatoLead.nome}, #{contatoLead.email}

                                    </h:panelGroup>
                                </p:commandLink>
                            </c:forEach>

                            <c:forEach var="usuarioResp" items="#{cc.attrs.empresa.usuariosResponsaveis}" >
                                <p:commandLink rendered="#{!cc.attrs.email.contatos.contains(usuarioResp.contatoVinculado)}" actionListener="#{cc.attrs.email.adicionarContato(usuarioResp.contatoVinculado)}" update="@form #{pgUtil.gerarCaminhoCompletoID('contatosProsp')}">
                                    <h:panelGroup layout="block" rendered="#{!cc.attrs.email.contatos.contains(contatoLead)}" styleClass="chipDiv">
                                        <h:panelGroup styleClass="fa fa-plus Fs16" style="color: #0277BD;" rendered="#{!cc.attrs.email.contatos.contains(usuarioResp.contatoVinculado)}" />#{usuarioResp.nome} #{usuarioResp.email}
                                    </h:panelGroup>
                                </p:commandLink>
                            </c:forEach>

                        </h:form>
                    </h:panelGroup>
                </p:fieldset>
            </h:panelGroup>
        </h:panelGroup>
        <h:panelGroup styleClass="Container12" style="margin-top: 20px;" layout="block" id="campo-anexos">
            <p:fieldset legend="Selecione os arquivos anexados:" rendered="#{cc.attrs.email!=null}" styleClass="Container5" style="height: 345px;width: 100%;"  >
                <h:panelGroup styleClass="Container12" layout="block" style="top:-30px;position: relative;" >

                    <h:form>
                        <SBCRMMAIL:inputEnvioEmailCampoAnexo
                            email="#{cc.attrs.email}"
                            colunasBotaoInsersao="12"
                            colunasLocalizacao="12"
                            />

                        <p:fieldset
                            id="arquivoRapidoAdd"
                            rendered="#{cc.attrs.email!=null}" styleClass="Container5" style="height: auto;width: 100%"  >
                            <h:panelGroup styleClass="Container12" layout="block" style="top:-30px;position: relative;" >

                                <c:forEach var="arquivo" items="#{cc.attrs.empresa.getCampoInstanciadoByNomeOuAnotacao('ultimosArquivos').valor}"    >
                                    <h:panelGroup layout="block" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" styleClass="chipDiv Container12">
                                        <h:panelGroup layout="block" styleClass="Container12" >
                                            <p:fragment >
                                                <p:commandLink rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" actionListener="#{cc.attrs.email.adicionarArquivoAnexado(arquivo)}"
                                                               styleClass=""
                                                               update="@form #{pgUtil.gerarCaminhoCompletoID('compEmailAnexos')}">
                                                    <h:panelGroup layout="block" styleClass="Container1" >
                                                        <h:panelGroup styleClass="fa fa-plus Fs16" style="color: #009900; margin: 0px;" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}" />
                                                    </h:panelGroup>
                                                    <h:panelGroup layout="block" styleClass="Container10 Fs12"  style=" margin: 0px;">
                                                        #{arquivo.arquivo}
                                                    </h:panelGroup>

                                                </p:commandLink>
                                                <h:panelGroup layout="block" styleClass="Container12 OrganizadorContainer"  style=" margin: 0px;margin-top: -20px;">
                                                    <p:link href="#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkAbrirArquivo}" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}"   >
                                                        <i class="fa fa-eye" /> ver
                                                    </p:link>
                                                    <p:link href="#{arquivo.getCampoInstanciadoByNomeOuAnotacao('arquivo').comoArquivoDeEntidade.linkBaixarArquivo}" rendered="#{!cc.attrs.email.arquivosAnexados.contains(arquivo)}"   >
                                                        <i class="fa fa-download" /> baixar
                                                    </p:link>
                                                </h:panelGroup>
                                            </p:fragment>
                                        </h:panelGroup>

                                    </h:panelGroup>
                                </c:forEach>

                            </h:panelGroup>

                        </p:fieldset>
                    </h:form>
                </h:panelGroup>
            </p:fieldset>
        </h:panelGroup>
        <h:panelGroup styleClass="Container12" layout="block">


            <h:form>
                <p:fragment >
                    <p:remoteCommand async="true" process="@this"
                                     actionListener="#{paginaAtual.comoPaginaComModalEmail.onModalAnexoEmailClose}"
                                     update="#{pgUtil.gerarCaminhoCompletoID('campo-anexos')}"
                                     name="atualizaranexos" />
                </p:fragment>


                <p:fragment >
                    <p:remoteCommand async="true" process="@parent"  update="@parent" name="atualizarValoresUploadDireto" >
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.entidade}" value="#{cc.attrs.empresa}" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.caminhoCampo}" value="arquivos" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.caminhoCampo}" value="arquivos" />
                        <f:setPropertyActionListener target="#{pgUtilUploadDeAnexoEmail.email}" value="#{cc.attrs.email}" />
                    </p:remoteCommand>
                </p:fragment>
                <p:fieldset rendered="#{cc.attrs.email==null}">
                    O email não foi configurado
                </p:fieldset>
            </h:form>




        </h:panelGroup>


    </cc:implementation>
</ui:composition>