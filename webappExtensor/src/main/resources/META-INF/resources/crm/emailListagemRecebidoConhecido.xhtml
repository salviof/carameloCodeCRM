<ui:composition
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:p="http://primefaces.org/ui"
    xmlns:CRM="http://xmlns.jcp.org/jsf/composite/crm"
    xmlns:CRMMail="http://xmlns.jcp.org/jsf/composite/crmEmail"
    xmlns:SBInput="http://xmlns.jcp.org/jsf/composite/SBComp/composite/input"
    xmlns:SBAcoes="http://xmlns.jcp.org/jsf/composite/SBComp/composite/acoesENavegacao"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="lista"
                      type="java.util.List" required="true"/>
    </cc:interface>
    <!-- IMPLEMENTATION -->
    <cc:implementation>

        <p:dataTable var="mail" value="#{cc.attrs.lista}"
                     reflow="true"
                     rows="20"
                     paginator="true"
                     widgetVar="listaEmails"
                     selection="#{pgEmails.entidadeSelecionada}"
                     selectionMode="single"
                     id="listaEmailsRecebidos"
                     rowKey="#{mail}"
                     lazy="false"
                     paginatorPosition="bottom"
                     >
            <f:facet name="header">
                <p:outputPanel>


                </p:outputPanel>
            </f:facet>
            <f:facet name="footer" >
                #{sessaoAtualSBWP.usuario.caixaPostalPrincipal.email}
            </f:facet>


            <p:ajax
                event="rowSelect" listener="#{pgEmails.abrirEmail()}"
                onstart="bloquearArea('#{pgUtil.gerarCaminhoCompletoID('listaEmailsRecebidos')}')"
                update="@form"
                />

            <p:column headerText="Tipo" width="60px;"   >
                <center> <i class="#{mail.getCampoInstanciadoByNomeOuAnotacao('iconeTipoEmail').valor}" ></i></center>
            </p:column>
            <p:column headerText="Data-Hora" width="250px;" sortable="true" sortBy="#{mail.dataHoraArmazenamento}">
                #{pgUtil.gerarDataHoraTexto(mail.getCampoByNomeOuAnotacao('dataHoraRecebimentoServerMail').valor)}
            </p:column>
            <p:column headerText="Enviado por" width="150px;">
                #{mail.getCampoByNomeOuAnotacao('emailDeMensagemOriginal').valor}
            </p:column>



            <p:column headerText="Responsável" width="350px;" >
                <p:graphicImage url="#{mail.prospecto.imgPequena}" width="30px;" /> #{mail.prospecto.nome}

            </p:column>

            <p:column headerText="Parceiros em cópia" width="150px;" >
                <span style="position: relative;right: 1px; float: left">
                    <ui:repeat value="#{mail.prospecto.usuariosResponsaveis}" var="usuario" >
                        <div style="position: relative;width: 30px; margin: 0px; float: left">
                            <CRM:avatar usuario="#{usuario}" somenteLeitura="#{true}" />
                        </div>
                    </ui:repeat>
                    <h:panelGroup rendered="#{mail.prospecto.usuariosResponsaveis.size()>3}" style="position: relative;width: 30px; margin: 0px; float: right;">
                        ...
                    </h:panelGroup>

                </span>
            </p:column>
            <p:column headerText="Lidor por" width="150px;" >
                <CRMMail:usuariosLeituraEmailRecebido   email="#{mail}"/>

            </p:column>

            <p:column headerText="Anexos" width="150px;" >
                <CRMMail:anexosDoEmail  email="#{mail}"/>

            </p:column>

            <p:column headerText="Assunto"  >
                <span class="FontAdamantiumBold">  #{mail.getCampoByNomeOuAnotacao('assunto').valor}</span>

            </p:column>
            <p:column headerText="Ações" width="150px;" >

                <SBAcoes:seletorDeAcoesComItem destinoItemSelecionado="#{pgEmails.entidadeSelecionada}"
                                               itemSelecionado="#{mail}"
                                               metodo="#{servicoEmail.iniciarAtividadeDeEmail(mail)}"
                                               opcoes="#{mail.getCampoInstanciadoByNomeOuAnotacao('acoesDisponiveis').valor}"
                                               opcaoSelecionada="#{servicoEmail.acaoDeEmailExecucao}"
                                               visualizacaoBotao="#{layoutsComponenteSB.layoutBotoes.icone}"
                                               />
            </p:column>
        </p:dataTable>

    </cc:implementation>
</ui:composition>